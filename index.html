<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <title>Prod App</title>
</head>
<body>
    <header>
        <h1>4 This is my Productivity App</h1>
    </header>
    <main>
        <div class="time box">
            <h1 class="" id="display">00:00:00</h1>
        </div>
        <div class="input box">
            <h2>Modo de trabajo para el d√≠a de hoy</h2>
            <select name="dropdoon" id="dropdown">
                <option value="Choose one">Choose one</option>
                <option value="Practice/Project">Practice/Project</option>
                <option value="Learn">Learn</option>
                <option value="Both">Both</option>
            </select>
            <button id="play" type="button" onclick="start()">Start</button>
            <button id="pause" type="button" onclick="stop()" disabled>Pause</button>
            <button id="end" type="button" onclick="finish()" disabled>End</button>
        </div>
    </main>
    <footer>
        <script>
                const play = document.getElementById("play");
                const pause = document.getElementById("pause");
                const end = document.getElementById("end");
                let display = document.getElementById("display");
                let cronometro = "";
                let hours = 0;
                let minutes = 0;
                let seconds = 0;
                let hidden = 0;
                let visible = 0;
                let standby = 0;
                let timer = 0;

                
            document.addEventListener("visibilitychange",() => {
                    if (pause.disabled == false) {
                        timer = hours * 3600 + minutes*60 + seconds;
                        if (document.hidden) {
                            hidden = Date.now()/1000; 
                        } else {visible = Date.now()/1000; 
                            console.log("timer", timer)
                        }
                        
                        standby = Math.floor(visible - hidden);
                        if(standby>0){
                            console.log(standby);
                            seconds+=(standby-1);
                            timer+= standby;   
                        }
                        hours = Math.floor(timer / 3600);
                        minutes = Math.floor(((timer / 3600) - hours)*60);
                        seconds = Math.floor((((timer / 3600) - hours)*60 - minutes)*60);

                    }
                });

        function crono() {   
                   
            if (document.visibilityState === "visible") {
                

                if(seconds == 59) {
                    seconds = 0;
                    if(minutes == 59) {
                        minutes = 0;
                        hours++;
                    } else minutes++;
                } else seconds++;
                if (seconds > 59) seconds-=60;
               // console.log(minutes,seconds,hours)
            // display
                if (seconds < 10 && minutes < 10 && hours < 10)
                display.textContent = `${"0"+hours}:${"0"+minutes}:${"0"+seconds}`;
                else if (minutes < 10 && hours < 10)
                display.textContent = `${"0"+hours}:${"0"+minutes}:${seconds}`;
                else if (hours < 10 && seconds < 10)
                display.textContent = `${"0"+hours}:${minutes}:${"0"+seconds}`;
                else if (minutes < 10 && seconds < 10)
                display.textContent = `${hours}:${"0"+minutes}:${"0"+seconds}`;
                else if (hours < 10)
                display.textContent = `${"0"+hours}:${minutes}:${seconds}`;
                else display.textContent = `${hours}:${minutes}:${seconds}`;
            }
        }
            function start() {
                cronometro = setInterval(crono, 1000);
                pause.disabled = false;
                play.disabled = true;
                end.disabled = false;
            }            
            function stop() {
                clearInterval(cronometro);
                pause.disabled = true;
                play.disabled = false;
                play.textContent = "Restart";
            }
            function finish() {
                stop();
                play.textContent = "Start";
                end.disabled = true;
                cronometro = "";
                hours = 0;
                minutes = 0;
                seconds = 0;
                hidden = 0;
                visible = 0;
                standby = 0;
                timer = 0;
                display.textContent = `${"0"+hours}:${"0"+minutes}:${"0"+seconds}`;
            }
        
        </script>
    </footer>
</body>
</html>
